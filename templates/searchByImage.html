<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <title>Search By Image</title>

    <link href="{{ url_for('static', filename='css/imageSearch.css') }}" rel="stylesheet">
    {{ bootstrap.load_css() }}
</head>


<body>

    {% include "partials/navbar.html" %}

    <br>

    <header id="search-header">
        <img id="camera-img" src="static/images/camera.png" alt="camera">
        <h1 class="heading"><b>Search By Image</b></h1>
    </header>

    <hr>

    <br>
        <div id="info-container" class="container">
          <br>
          <h2 class="message"><b>Welcome to the Search by Image Feature of the Pokédex! <br/> This feature allows you to detect any of the 151 First Generation Pokémon.<br/> To get started, upload an image - </b></h2>
          <br>
    <hr>
    <br>

    <form style=" width: 45vw; margin-left : 22vw;">
        <input id="file-upload" type="file" accept="image/*">
        <img id="image-upload" crossorigin="anonymous" style="width:150px">
    </form>

    <br>


    <p id="Result"></p>

    </div>    
    
    <!-- <button class="btn-primary" id=""> Get Prediction </button> -->

    <!-- [START deps]  -->
    <script src="https://unpkg.com/@tensorflow/tfjs"></script>
    <script src="https://unpkg.com/@tensorflow/tfjs-automl"></script>
    <!-- [END deps]  -->

    <script>
        async function run() {
          // [START load_and_run_model]
          const model = await tf.automl.loadImageClassification('static/model/model.json');
          const image = document.getElementById('image-upload');
          const predictions = await model.classify(image);
          // [END load_and_run_model]


          //sort labels by probability
          predictions.sort(sortByProperty("prob"));



          document.getElementById("Result").innerText = predictions[0]["label"].toUpperCase();
          // Show the resulting object on the page.
          const pre = document.createElement('pre');
          pre.textContent = JSON.stringify(predictions, null, 2);

           //document.body.append(pre);

        }

        function sortByProperty(property) {
            return function (a, b) {
            if (a[property] < b[property]) return 1;
            else if (a[property] > b[property]) return -1;

            return 0;
            };
        }


        document.getElementById("file-upload").onchange = function(event) {
            const img = document.getElementById('image-upload');
            img.src = URL.createObjectURL(event.target.files[0])
            img.alt = 'image';
            run();
        }
    </script>


</body>
</html>